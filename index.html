<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Now</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        <link rel="stylesheet" href="style.css" />
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f1729 0%, #1a2847 100%);
            min-height: 100vh;
        }

        .weather-card {
            background: linear-gradient(135deg, #3b5998 0%, #2d4373 100%);
            border-radius: 24px;
            position: relative;
            overflow: hidden;
        }

        .weather-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }

        .weather-card::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -5%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50%;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .sun-icon {
            width: 48px;
            height: 48px;
            background: #FFB800;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .search-input:focus {
            outline: none;
            border: 2px solid #6366F1;
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-search {
            background: #6366F1;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-search:hover {
            background: #4F46E5;
            transform: translateY(-2px);
        }

        .weather-stat {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .forecast-day {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .forecast-day:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .hourly-item {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top-color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .dropdown-menu {
            background: rgba(30, 30, 50, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            min-width: 200px;
        }

        .dropdown-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dropdown-item:hover {
            background: rgba(99, 102, 241, 0.2);
        }

        .dropdown-item.active {
            color: #6366F1;
        }

        .weather-icon {
            font-size: 32px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body class="text-white">
    <div class="min-h-screen p-6">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div class="flex items-center gap-3">
                <div class="sun-icon">‚òÄÔ∏è</div>
                <h1 class="text-2xl font-bold">Weather Now</h1>
            </div>
            <div class="relative">
                <button id="unitsBtn" class="glass-card px-4 py-2 flex items-center gap-2 hover:bg-white hover:bg-opacity-15 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Units
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                    </svg>
                </button>
                <div id="unitsDropdown" class="dropdown-menu hidden absolute top-12 right-0 z-50">
                    <div class="p-3 text-xs font-semibold text-gray-400">Temperature</div>
                    <div class="dropdown-item active" data-temp="C">Celsius (¬∞C)</div>
                    <div class="dropdown-item" data-temp="F">Fahrenheit (¬∞F)</div>
                    <div class="border-t border-white border-opacity-10 my-2"></div>
                    <div class="p-3 text-xs font-semibold text-gray-400">Wind Speed</div>
                    <div class="dropdown-item active" data-wind="kmh">km/h</div>
                    <div class="dropdown-item" data-wind="mph">mph</div>
                    <div class="border-t border-white border-opacity-10 my-2"></div>
                    <div class="p-3 text-xs font-semibold text-gray-400">Precipitation</div>
                    <div class="dropdown-item active" data-precip="mm">Millimeters (mm)</div>
                    <div class="dropdown-item" data-precip="in">Inches (in)</div>
                </div>
            </div>
        </div>

        <!-- Main Title -->
        <h2 class="text-5xl font-bold text-center mb-12">How's the sky looking today?</h2>

        <!-- Search Section -->
        <div class="max-w-4xl mx-auto mb-8">
            <div class="flex gap-4">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input flex-1" 
                    placeholder="Search for a place..."
                    autocomplete="off"
                >
                <button id="searchBtn" class="btn-search">Search</button>
            </div>
            <div id="suggestions" class="hidden mt-2 dropdown-menu max-h-60 overflow-y-auto"></div>
        </div>

        <!-- Weather Content -->
        <div class="max-w-7xl mx-auto">
            <!-- Initial State -->
            <div id="initialState" class="text-center py-16">
                <p class="text-xl text-gray-300">Search for a city to see the weather forecast</p>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="hidden text-center py-16">
                <div class="flex flex-col items-center gap-4">
                    <div class="spinner"></div>
                    <p class="text-lg text-gray-300">Loading...</p>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden text-center py-16">
                <div class="flex flex-col items-center gap-4">
                    <svg class="w-16 h-16 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h3 class="text-2xl font-bold">Something went wrong</h3>
                    <p class="text-gray-400">We couldn't connect to the server (API error). Please try again in a few moments.</p>
                    <button id="retryBtn" class="btn-search mt-4">Retry</button>
                </div>
            </div>

            <!-- No Results State -->
            <div id="noResultsState" class="hidden text-center py-16">
                <p class="text-xl text-gray-300">No search result found!</p>
            </div>

            <!-- Weather Data State -->
            <div id="weatherState" class="hidden">
                <!-- Current Weather -->
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="col-span-2">
                        <div class="weather-card p-8 relative z-10">
                            <div class="flex justify-between items-start mb-8">
                                <div>
                                    <h3 id="cityName" class="text-3xl font-bold mb-2">Berlin, Germany</h3>
                                    <p id="dateTime" class="text-gray-300">Tuesday, Aug 5, 2025</p>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div id="weatherIcon" class="weather-icon">‚òÄÔ∏è</div>
                                    <div id="tempDisplay" class="text-7xl font-bold">20¬∞</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hourly Forecast (Right Side) -->
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold">Hourly forecast</h4>
                            <select id="daySelector" class="glass-card px-3 py-1 text-sm rounded cursor-pointer">
                                <option>Today</option>
                                <option>Tomorrow</option>
                            </select>
                        </div>
                        <div id="hourlyForecast" class="space-y-3 max-h-96 overflow-y-auto">
                            <!-- Hourly items will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Weather Stats -->
                <div class="grid grid-cols-4 gap-4 mb-8">
                    <div class="weather-stat">
                        <p class="text-gray-400 text-sm mb-2">Feels Like</p>
                        <p id="feelsLike" class="text-3xl font-bold">--¬∞</p>
                    </div>
                    <div class="weather-stat">
                        <p class="text-gray-400 text-sm mb-2">Humidity</p>
                        <p id="humidity" class="text-3xl font-bold">--%</p>
                    </div>
                    <div class="weather-stat">
                        <p class="text-gray-400 text-sm mb-2">Wind</p>
                        <p id="wind" class="text-3xl font-bold">-- km/h</p>
                    </div>
                    <div class="weather-stat">
                        <p class="text-gray-400 text-sm mb-2">Precipitation</p>
                        <p id="precipitation" class="text-3xl font-bold">-- mm</p>
                    </div>
                </div>

                <!-- Daily Forecast -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Daily forecast</h4>
                    <div id="dailyForecast" class="grid grid-cols-7 gap-3">
                        <!-- Daily forecast items will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'https://api.open-meteo.com/v1/forecast';
        const GEOCODING_API = 'https://geocoding-api.open-meteo.com/v1/search';

        // State Management
        let units = {
            temp: 'C',
            wind: 'kmh',
            precip: 'mm'
        };

        let currentWeatherData = null;
        let currentCoordinates = null;

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const suggestions = document.getElementById('suggestions');
        const unitsBtn = document.getElementById('unitsBtn');
        const unitsDropdown = document.getElementById('unitsDropdown');
        const retryBtn = document.getElementById('retryBtn');

        // State Elements
        const initialState = document.getElementById('initialState');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const noResultsState = document.getElementById('noResultsState');
        const weatherState = document.getElementById('weatherState');

        // Event Listeners
        searchInput.addEventListener('input', debounce(handleSearch, 300));
        searchBtn.addEventListener('click', searchCity);
        searchInput.addEventListener('keypress', (e) => e.key === 'Enter' && searchCity());
        unitsBtn.addEventListener('click', toggleUnitsDropdown);
        retryBtn.addEventListener('click', searchCity);

        // Units Dropdown
        document.querySelectorAll('.dropdown-item[data-temp]').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.dropdown-item[data-temp]').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                units.temp = item.dataset.temp;
                if (currentWeatherData) updateDisplay();
            });
        });

        document.querySelectorAll('.dropdown-item[data-wind]').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.dropdown-item[data-wind]').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                units.wind = item.dataset.wind;
                if (currentWeatherData) updateDisplay();
            });
        });

        document.querySelectorAll('.dropdown-item[data-precip]').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.dropdown-item[data-precip]').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                units.precip = item.dataset.precip;
                if (currentWeatherData) updateDisplay();
            });
        });

        // Debounce function
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        // Search city suggestions
        async function handleSearch(e) {
            const query = e.target.value.trim();
            if (query.length < 2) {
                suggestions.classList.add('hidden');
                return;
            }

            try {
                const response = await fetch(`${GEOCODING_API}?name=${encodeURIComponent(query)}&count=5&language=en&format=json`);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    suggestions.innerHTML = data.results.map(city => `
                        <div class="dropdown-item cursor-pointer" onclick="selectCity('${city.name}', '${city.admin1 || ''}', '${city.country}', ${city.latitude}, ${city.longitude})">
                            <div class="font-semibold">${city.name}</div>
                            <div class="text-xs text-gray-400">${city.admin1 ? city.admin1 + ', ' : ''}${city.country}</div>
                        </div>
                    `).join('');
                    suggestions.classList.remove('hidden');
                } else {
                    suggestions.classList.add('hidden');
                }
            } catch (error) {
                console.error('Search error:', error);
                suggestions.classList.add('hidden');
            }
        }

        // Select city from suggestions
        function selectCity(name, admin, country, lat, lon) {
            searchInput.value = `${name}, ${country}`;
            suggestions.classList.add('hidden');
            currentCoordinates = { name, admin, country, latitude: lat, longitude: lon };
            fetchWeather(lat, lon, name, admin, country);
        }

        // Search button click
        function searchCity() {
            const query = searchInput.value.trim();
            if (!query) return;

            showLoading();
            searchByCityName(query);
        }

        // Search by city name
        async function searchByCityName(query) {
            try {
                const response = await fetch(`${GEOCODING_API}?name=${encodeURIComponent(query)}&count=1&language=en&format=json`);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const city = data.results[0];
                    currentCoordinates = {
                        name: city.name,
                        admin: city.admin1 || '',
                        country: city.country,
                        latitude: city.latitude,
                        longitude: city.longitude
                    };
                    fetchWeather(city.latitude, city.longitude, city.name, city.admin1 || '', city.country);
                } else {
                    showNoResults();
                }
            } catch (error) {
                showError();
            }
        }

        // Fetch weather data
        async function fetchWeather(lat, lon, cityName, admin, country) {
            try {
                const params = new URLSearchParams({
                    latitude: lat,
                    longitude: lon,
                    current: 'temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m,apparent_temperature,precipitation',
                    hourly: 'temperature_2m,weather_code,precipitation_probability',
                    daily: 'weather_code,temperature_2m_max,temperature_2m_min',
                    timezone: 'auto',
                    temperature_unit: units.temp === 'F' ? 'fahrenheit' : 'celsius',
                    wind_speed_unit: units.wind === 'mph' ? 'mph' : 'kmh',
                    precipitation_unit: units.precip === 'in' ? 'inch' : 'mm'
                });

                const response = await fetch(`${API_BASE}?${params}`);
                const data = await response.json();

                currentWeatherData = {
                    ...data,
                    cityName: `${cityName}, ${country}`,
                    admin,
                    country
                };

                updateDisplay();
            } catch (error) {
                showError();
            }
        }

        // Update UI with weather data
        function updateDisplay() {
            if (!currentWeatherData) return;

            const { current, hourly, daily, timezone, cityName } = currentWeatherData;
            const now = new Date().toLocaleString('en-US', { timeZone: timezone });

            // Update current weather
            document.getElementById('cityName').textContent = cityName;
            document.getElementById('dateTime').textContent = new Date(now).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' });
            document.getElementById('tempDisplay').textContent = `${Math.round(current.temperature_2m)}¬∞`;
            document.getElementById('feelsLike').textContent = `${Math.round(current.apparent_temperature)}¬∞`;
            document.getElementById('humidity').textContent = `${current.relative_humidity_2m}%`;
            document.getElementById('wind').textContent = `${Math.round(current.wind_speed_10m)} ${units.wind === 'mph' ? 'mph' : 'km/h'}`;
            document.getElementById('precipitation').textContent = `${current.precipitation} ${units.precip === 'in' ? 'in' : 'mm'}`;
            document.getElementById('weatherIcon').textContent = getWeatherIcon(current.weather_code);

            // Update hourly forecast
            updateHourlyForecast(hourly, timezone);

            // Update daily forecast
            updateDailyForecast(daily);

            showWeather();
        }

        // Update hourly forecast
        function updateHourlyForecast(hourly, timezone) {
            const now = new Date();
            const currentHour = now.getHours();
            const today = new Date(now.toLocaleString('en-US', { timeZone: timezone })).toDateString();

            const hourlyContainer = document.getElementById('hourlyForecast');
            hourlyContainer.innerHTML = '';

            for (let i = 0; i < 12; i++) {
                const index = currentHour + i;
                if (index < hourly.time.length) {
                    const time = new Date(hourly.time[index]);
                    const displayTime = time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', timeZone: timezone });
                    const temp = hourly.temperature_2m[index];
                    const icon = getWeatherIcon(hourly.weather_code[index]);

                    hourlyContainer.innerHTML += `
                        <div class="hourly-item">
                            <span>${displayTime}</span>
                            <span>${icon}</span>
                            <span>${Math.round(temp)}¬∞</span>
                        </div>
                    `;
                }
            }
        }

        // Update daily forecast
        function updateDailyForecast(daily) {
            const dailyContainer = document.getElementById('dailyForecast');
            dailyContainer.innerHTML = '';

            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            for (let i = 0; i < 7; i++) {
                const date = new Date(daily.time[i]);
                const dayName = dayNames[date.getDay()];
                const high = Math.round(daily.temperature_2m_max[i]);
                const low = Math.round(daily.temperature_2m_min[i]);
                const icon = getWeatherIcon(daily.weather_code[i]);

                dailyContainer.innerHTML += `
                    <div class="forecast-day">
                        <p class="font-semibold mb-2">${dayName}</p>
                        <p class="text-2xl mb-2">${icon}</p>
                        <div class="flex justify-center gap-2 text-sm">
                            <span>${high}¬∞</span>
                            <span class="text-gray-400">${low}¬∞</span>
                        </div>
                    </div>
                `;
            }
        }

        // Get weather icon based on WMO code
        function getWeatherIcon(code) {
            if (!code) return '‚ùì';
            
            if (code === 0 || code === 1) return '‚òÄÔ∏è'; // Clear sky
            if (code === 2) return '‚õÖ'; // Partly cloudy
            if (code === 3) return '‚òÅÔ∏è'; // Overcast
            if (code === 45 || code === 48) return 'üå´Ô∏è'; // Foggy
            if (code === 51 || code === 53 || code === 55) return 'üåßÔ∏è'; // Drizzle
            if (code === 61 || code === 63 || code === 65) return 'üåßÔ∏è'; // Rain
            if (code === 71 || code === 73 || code === 75) return '‚ùÑÔ∏è'; // Snow
            if (code === 80 || code === 81 || code === 82) return 'üåßÔ∏è'; // Rain showers
            if (code === 85 || code === 86) return '‚ùÑÔ∏è'; // Snow showers
            if (code === 95 || code === 96 || code === 99) return '‚õàÔ∏è'; // Thunderstorm
            
            return '‚ùì';
        }

        // UI State Management
        function showLoading() {
            initialState.classList.add('hidden');
            errorState.classList.add('hidden');
            noResultsState.classList.add('hidden');
            weatherState.classList.add('hidden');
            loadingState.classList.remove('hidden');
        }

        function showWeather() {
            initialState.classList.add('hidden');
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            noResultsState.classList.add('hidden');
            weatherState.classList.remove('hidden');
        }

        function showError() {
            initialState.classList.add('hidden');
            loadingState.classList.add('hidden');
            noResultsState.classList.add('hidden');
            weatherState.classList.add('hidden');
            errorState.classList.remove('hidden');
        }

        function showNoResults() {
            initialState.classList.add('hidden');
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            weatherState.classList.add('hidden');
            noResultsState.classList.remove('hidden');
        }

        function toggleUnitsDropdown() {
            unitsDropdown.classList.toggle('hidden');
            document.addEventListener('click', closeUnitsDropdown);
        }

        function closeUnitsDropdown(e) {
            if (!unitsBtn.contains(e.target) && !unitsDropdown.contains(e.target)) {
                unitsDropdown.classList.add('hidden');
                document.removeEventListener('click', closeUnitsDropdown);
            }
        }

        // Click outside to close suggestions
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
                suggestions.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
